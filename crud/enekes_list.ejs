<div class="crud-container">

    <h1 class="page-title">Énekesek Archívuma (<%= enekesek.length %> bejegyzés)</h1>

    <% if (messages && messages.length > 0) { %>
        <div class="success-notification" id="success-msg">
            <%= messages[0] %>
            <button class="notification-close" onclick="document.getElementById('success-msg').style.display='none'">
                &times;
            </button>
        </div>
        
        <script>
            setTimeout(() => {
                const msg = document.getElementById('success-msg');
                if (msg) {
                    msg.style.display = 'none';
                }
            }, 3000);
        </script>
    <% } %>

    <div class="crud-controls">
        <input type="text" id="searchInput" placeholder="Keresés névre..." onkeyup="filterTable()" class="search-input">
        <a href="/crud/add" class="add-new-btn">Új énekes hozzáadása</a>
    </div>

    <% if (enekesek.length > 0) { %>
        <table id="enekesTable">
            <thead>
                <tr>
                    <th>Név</th>
                    <th>Születési év</th>
                    <th style="text-align: right;">Műveletek</th>
                </tr>
            </thead>
            <tbody>
                <% enekesek.forEach(enekes => { %>
                    <tr>
                        <td class="enekes-nev" style="font-weight: 600; color: #fff;"><%= enekes.nev %></td>
                        <td><%= enekes.szulev %></td>
                        <td style="text-align: right;">
                            <div style="display: flex; justify-content: flex-end; gap: 10px;">
                                <a href="/crud/edit/<%= enekes._id %>" class="action-button">Szerkesztés</a>
                                
                                <form method="POST" action="/crud/delete/<%= enekes._id %>" style="margin:0; padding:0; background:transparent; box-shadow:none;">
                                    <button type="submit" class="action-button" onclick="return confirm('Biztosan törölni szeretnéd ezt az énekest?')">Törlés</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                <% }); %>
            </tbody>
        </table>
    <% } else { %>
        <p style="text-align: center; color: #888; margin-top: 30px;">Jelenleg nincs énekes az adatbázisban.</p>
    <% } %>

</div>

<script>
function filterTable() {
    const input = document.getElementById('searchInput');
    const filter = input.value.toUpperCase();
    const table = document.getElementById('enekesTable');
    if (!table) return;
    const tr = table.getElementsByTagName('tr');

    for (let i = 1; i < tr.length; i++) {
        const nameCell = tr[i].getElementsByClassName('enekes-nev')[0];
        
        if (nameCell) {
            const textValue = nameCell.textContent || nameCell.innerText;
            
            if (textValue.toUpperCase().indexOf(filter) > -1) {
                tr[i].style.display = '';
            } else {
                tr[i].style.display = 'none';
            }
        }       
    }
}
</script>